<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            background: #f5f5f5;
        }
        #sidebar {
            width: 300px;
            background: #2c3e50;
            color: white;
            padding: 20px;
            overflow-y: auto;
        }
        #sidebar h2 {
            margin-top: 0;
            font-size: 1.5em;
        }
        #new-chat {
            width: 100%;
            padding: 10px;
            background: #3498db;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        #chat-list {
            list-style: none;
            padding: 0;
        }
        #chat-list li {
            padding: 10px;
            background: #34495e;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        #chat-list li:hover {
            background: #3e5c76;
        }
        #chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            background: #ecf0f1;
        }
        #model-info {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        #messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #input-area {
            display: flex;
            margin-top: 15px;
        }
        #message-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: none;
            height: 50px;
        }
        #send-button {
            padding: 10px 20px;
            margin-left: 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 5px;
            max-width: 80%;
        }
        .user-message {
            background: #3498db;
            color: white;
            margin-left: auto;
        }
        .assistant-message {
            background: #ecf0f1;
            color: #2c3e50;
            margin-right: auto;
        }
        #new-chat-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            max-height: 80vh;
            overflow-y: auto;
        }
        #new-chat-dialog select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        #new-chat-dialog button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="sidebar">
            <h2>Chat History</h2>
            <button id="new-chat">New Chat</button>
            <ul id="chat-list"></ul>
        </div>
        <div id="chat-area">
            <div id="model-info">Using model: <span id="current-model">None selected</span></div>
            <div id="messages"></div>
            <div id="input-area">
                <textarea id="message-input" placeholder="Type your message..."></textarea>
                <button id="send-button">Send</button>
            </div>
        </div>
    </div>
    <script src="https://js.puter.com/v2/"></script>
    <script>
        // Define all models as per the query
        const modelGroups = {
            'OpenAI': [
                { name: 'GPT-4.1', value: 'gpt-4.1' },
                { name: 'GPT-4.1 Mini', value: 'gpt-4.1-mini' },
                { name: 'GPT-4.1 Nano', value: 'gpt-4.1-nano' },
                { name: 'GPT-4.5 Preview', value: 'gpt-4.5-preview' },
                { name: 'GPT-4o', value: 'gpt-4o' },
                { name: 'GPT-4o Mini', value: 'gpt-4o-mini' },
                { name: 'o1', value: 'o1' },
                { name: 'o1 Mini', value: 'o1-mini' },
                { name: 'o1 Pro', value: 'o1-pro' },
                { name: 'o3', value: 'o3' },
                { name: 'o3 Mini', value: 'o3-mini' },
                { name: 'o4 Mini', value: 'o4-mini' }
            ],
            'Anthropic': [
                { name: 'Claude Sonnet 4', value: 'claude-sonnet-4' },
                { name: 'Claude Opus 4', value: 'claude-opus-4' }
            ],
            'xAI': [
                { name: 'Grok 3 Beta', value: 'x-ai/grok-3-beta' }
            ],
            'Meta': [
                { name: 'Llama 4 Maverick', value: 'meta-llama/llama-4-maverick' },
                { name: 'Llama 4 Scout', value: 'meta-llama/llama-4-scout' },
                { name: 'Llama 3.3 70B Instruct', value: 'meta-llama/llama-3.3-70b-instruct' },
                { name: 'Llama 3.2 3B Instruct', value: 'meta-llama/llama-3.2-3b-instruct' },
                { name: 'Llama 3.2 1B Instruct', value: 'meta-llama/llama-3.2-1b-instruct' },
                { name: 'Llama 3.1 405B', value: 'meta-llama/llama-3.1-405b' },
                { name: 'Llama 3.1 8B Instruct', value: 'meta-llama/llama-3.1-8b-instruct' },
                { name: 'Llama 3.1 405B Instruct', value: 'meta-llama/llama-3.1-405b-instruct' },
                { name: 'Llama 3.1 70B Instruct', value: 'meta-llama/llama-3.1-70b-instruct' },
                { name: 'Llama 3 8B Instruct', value: 'meta-llama/llama-3-8b-instruct' },
                { name: 'Llama 3 70B Instruct', value: 'meta-llama/llama-3-70b-instruct' },
                { name: 'Llama 2 70B Chat', value: 'meta-llama/llama-2-70b-chat' },
                { name: 'Llama 2 13B Chat', value: 'meta-llama/llama-2-13b-chat' },
                { name: 'Llama Guard 3 8B', value: 'meta-llama/llama-guard-3-8b' },
                { name: 'Llama Guard 2 8B', value: 'meta-llama/llama-guard-2-8b' }
            ],
            'Google': [
                { name: 'Gemini 2.5 Flash Preview', value: 'google/gemini-2.5-flash-preview' },
                { name: 'Gemini 2.5 Flash Preview (Thinking)', value: 'google/gemini-2.5-flash-preview:thinking' },
                { name: 'Gemini 2.5 Pro Exp 03-25', value: 'google/gemini-2.5-pro-exp-03-25:free' },
                { name: 'Gemini 2.0 Flash Lite 001', value: 'google/gemini-2.0-flash-lite-001' },
                { name: 'Gemini 2.0 Flash 001', value: 'google/gemini-2.0-flash-001' },
                { name: 'Gemini 2.0 Pro Exp 02-05', value: 'google/gemini-2.0-pro-exp-02-05:free' },
                { name: 'Gemini 2.0 Flash Thinking Exp', value: 'google/gemini-2.0-flash-thinking-exp:free' },
                { name: 'Gemini 2.0 Flash Thinking Exp 1219', value: 'google/gemini-2.0-flash-thinking-exp-1219:free' },
                { name: 'Gemini 2.0 Flash Exp', value: 'google/gemini-2.0-flash-exp:free' },
                { name: 'Gemini Flash 1.5 8B', value: 'google/gemini-flash-1.5-8b' },
                { name: 'Gemini Flash 1.5 8B Exp', value: 'google/gemini-flash-1.5-8b-exp' },
                { name: 'Gemini Flash 1.5', value: 'google/gemini-flash-1.5' },
                { name: 'Gemini Pro 1.5', value: 'google/gemini-pro-1.5' },
                { name: 'Gemini Pro', value: 'google/gemini-pro' }
            ],
            'OpenRouter': [
                { name: '01-ai Yi Large', value: 'openrouter:01-ai/yi-large' },
                { name: 'Aetherwiing MN Starcannon 12B', value: 'openrouter:aetherwiing/mn-starcannon-12b' },
                { name: 'Agentica Deepcoder 14B Preview', value: 'openrouter:agentica-org/deepcoder-14b-preview:free' },
                { name: 'AI21 Jamba 1.6 Large', value: 'openrouter:ai21/jamba-1.6-large' },
                { name: 'AI21 Jamba 1.6 Mini', value: 'openrouter:ai21/jamba-1.6-mini' },
                { name: 'Aion Labs Aion 1.0', value: 'openrouter:aion-labs/aion-1.0' },
                // Add all other OpenRouter models from the list here (abridged for brevity)
                { name: 'Meta Llama 3.1 8B Instruct', value: 'openrouter:meta-llama/llama-3.1-8b-instruct' },
                { name: 'Anthropic Claude 3.5 Sonnet', value: 'openrouter:anthropic/claude-3.5-sonnet' },
                // Include all models prefixed with "openrouter:" as listed
            ]
        };

        let chats = [];
        let currentChatId = null;

        // Load chats from local storage
        function loadChats() {
            const savedChats = localStorage.getItem('chats');
            if (savedChats) {
                chats = JSON.parse(savedChats);
                updateChatList();
            }
        }

        // Save chats to local storage
        function saveChats() {
            localStorage.setItem('chats', JSON.stringify(chats));
        }

        // Update chat list in sidebar
        function updateChatList() {
            const chatList = document.getElementById('chat-list');
            chatList.innerHTML = '';
            chats.forEach(chat => {
                const li = document.createElement('li');
                li.textContent = chat.title;
                li.addEventListener('click', () => selectChat(chat.id));
                chatList.appendChild(li);
            });
        }

        // Select a chat
        function selectChat(id) {
            currentChatId = id;
            const chat = chats.find(c => c.id === id);
            document.getElementById('current-model').textContent = chat.model;
            displayMessages(chat.messages);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        // Display messages in chat area
        function displayMessages(messages) {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message ' + (msg.role === 'user' ? 'user-message' : 'assistant-message');
                messageDiv.textContent = msg.content;
                messagesDiv.appendChild(messageDiv);
            });
        }

        // Show new chat dialog with model selector
        function showNewChatDialog() {
            const dialog = document.createElement('div');
            dialog.id = 'new-chat-dialog';
            dialog.innerHTML = `
                <h3>Select Model</h3>
                <select id="model-select">
                    ${Object.keys(modelGroups).map(group => `
                        <optgroup label="${group}">
                            ${modelGroups[group].map(model => `
                                <option value="${model.value}">${model.name}</option>
                            `).join('')}
                        </optgroup>
                    `).join('')}
                </select>
                <button id="create-chat">Create Chat</button>
            `;
            document.body.appendChild(dialog);
            document.getElementById('create-chat').addEventListener('click', () => {
                const selectedModel = document.getElementById('model-select').value;
                createNewChat(selectedModel);
                document.body.removeChild(dialog);
            });
        }

        // Create a new chat
        function createNewChat(model) {
            const id = Date.now().toString();
            const modelName = Object.values(modelGroups).flat().find(m => m.value === model).name;
            const title = `Chat with ${modelName}`;
            const newChat = { id, title, model, messages: [] };
            chats.push(newChat);
            saveChats();
            updateChatList();
            selectChat(id);
        }

        // Send a message
        async function sendMessage() {
            if (!currentChatId) {
                alert('Please select or start a chat first.');
                return;
            }
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message) return;
            input.value = '';

            const chat = chats.find(c => c.id === currentChatId);
            chat.messages.push({ role: 'user', content: message });
            displayMessages(chat.messages);

            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'message assistant-message';
            thinkingDiv.textContent = 'Thinking...';
            document.getElementById('messages').appendChild(thinkingDiv);

            try {
                const response = await puter.ai.chat(chat.messages, {
                    model: chat.model,
                    stream: true
                });

                let assistantMessage = '';
                thinkingDiv.textContent = '';
                for await (const part of response) {
                    if (part?.text) {
                        assistantMessage += part.text;
                        thinkingDiv.textContent = assistantMessage;
                    }
                }
                chat.messages.push({ role: 'assistant', content: assistantMessage });
                saveChats();
            } catch (error) {
                thinkingDiv.textContent = `Error: ${error.message}`;
            }
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        // Event listeners
        document.getElementById('new-chat').addEventListener('click', showNewChatDialog);
        document.getElementById('send-button').addEventListener('click', sendMessage);
        document.getElementById('message-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Load chats on startup
        loadChats();
    </script>
</body>
</html>
